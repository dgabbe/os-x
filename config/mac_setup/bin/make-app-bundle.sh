#!/usr/bin/env bash

# arg1: name of .dist file, generated by Nuitka

# Summary:
# Translate a .dist bundle into a MacOS .app bundle

# check on whether cp preserves or creates new file creation date.

# Add set option for undeclared variables

# Parameter validation
[[ -z $1 ]] && { echo "Usage: ${0} filename.dist"; exit 1; }

dist_name=$1
[[ ! -d "${dist_name}" ]] && { echo "Error: ${dist_name} does not exist."; exit 1; }

# Start of build
app_path='./app/'
build_path="${app_path}/builds"
app_name=${dist_name%.dist*}
app_path="${build_path}/${app_name}.app/"
d=$(date +"%Y-%m-%d-%H%M")

if [[ ! -d "${build_path}" ]]; then
    mkdir -p ${build_path}
else
    [[ -d ${app_path} ]] && mv ${app_path} ${build_path}/${app_name}.${d}
fi

echo "End of test portion"
exit 0 # for testing

mkdir -p ${build_path}/Contents/MacOS
mkdir -p ${build_path}/Resources
cp -r ${app_path}/Contents/ ${build_path}/Contents/
cp -r ${app_path}/Resources ${build_path}/Contents/Resources
mv -r ${app_name}.dist/* ${build_path}/Contents/MacOS/

# Assume that Nuitka process copied over special Python related files
